@isAttackableBodyPart(partIdx)
#function
#dim dynamic partIdx
#dims dynamic partName

	if strlens(BASENAME:i) == 0
		returnf 0
	endif
	
	if CFLAG:(200 + i) == 2 && !ABL:TARGET:도구사용
		returnf 0
	elseif CFLAG:(200 + i) > 2
		returnf 0
	endif

	partName = %STR:i%

	; 요도->방광 순
	if partName == "방광" && CFLAG:MASTER:삽입요도 == 0
		returnf 0
	endif
	; 자궁->난소 순
	if partName == "난소" && CFLAG:MASTER:삽입자궁 == 0
		returnf 0
	endif
	; 질->자궁 순
	if partName == "자궁" && CFLAG:MASTER:삽입질 == 0
		returnf 0
	endif
	
	; 상의를 입고 있는 경우
	if partName == "유두" && (EQUIP:MASTER:상의 != 0 || EQUIP:MASTER:속옷 != 0)
		returnf 0
	endif

	; 하의를 입고 있는 경우
	if partName == "질" && (EQUIP:MASTER:하의 != 0 || EQUIP:MASTER:속옷 != 0)
		returnf 0
	endif
	if partName == "애널" && (EQUIP:MASTER:하의 != 0 || EQUIP:MASTER:속옷 != 0)
		returnf 0
	endif
	if partName == "요도" && (EQUIP:MASTER:하의 != 0 || EQUIP:MASTER:속옷 != 0)
		returnf 0
	endif

	returnf 1

@getSexualAtkBodyPart
#dim dynamic partsCount
#dim dynamic availableParts, 100

	if TCVAR:TARGET:성희롱부위 && isAttackableBodyPart(TCVAR:TARGET:성희롱부위)
		if RAND:5 < 4
			return TCVAR:TARGET:성희롱부위
		endif
	endif

	partsCount = 0
	for i, 101, 200
		if isAttackableBodyPart(i)
			availableParts:(partsCount++) = i
		endif
	next

	return availableParts:(RAND:partsCount)

@sexualInsert(attackedIdx)
#dim dynamic attackedIdx

	CFLAG:MASTER:(200 + attackedIdx) = 1
	EXP:MASTER:attackedIdx++
